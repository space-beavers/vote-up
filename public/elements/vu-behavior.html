<link rel="import" href="../bower_components/app-storage/app-network-status-behavior.html">
<script>

  var MyBehaviors = MyBehaviors || {};

  var VoteUpAppBehaviorImpl = {
      properties: {
        userUuid: {
          type: String,
          observer: "userUuidObserver"
        },

        editableTopicId: {
          type: String,
          notify: true
        }
      },

      get topicsPath() {
        return '';
      },

      get isEditable() {
        return true;
      },

      get user() {
        return this.userUuid;
      },

      toEditableId(topicId) {
        return topicId;
      },

      userUuidObserver: function (newValue, oldValue){
          console.log("yo"+newValue);
      },

      edit(event) {
        if (event.currentTarget.isEditable) {
          let topicElement = Polymer.dom(event).localTarget;
          this.editableTopicId = this.toEditableId(topicElement.id);

          this.$.document.transactionsComplete.then(() => {
            this.$.editor.open(topicElement);
          });
        }
      },

      create() {
        if (this.isEditable) {
          this.editableTopicId = null;
          this.$.editor.open();
        }
      },

      commitChange(event) {
        var changeCommits;

        switch (event.detail) {
          case 'save':
            changeCommits = this.save();
            break;
          case 'delete':
            changeCommits = this.delete();
            break;
          default:
            changeCommits = Promise.resolve();
            break;
        }
      },

      save() {
        if (this.$.document.isNew &&
            (this.editableTopic.title ||
             this.editableTopic.description)) {
          this.editableTopic.createdBy = this.user.uid;
          return this.$.document.save(this.topicsPath).then(() => {
            this.$.document.reset();
          });
        }

        return Promise.resolve();
      },

      delete() {
        if (!this.$.document.isNew) {
          this.$.document.destroy();
        }

        return Promise.resolve();
      },

      signOut() {
        if (this.$.auth) {
          this.$.auth.signOut();
        }
      },

      firebaseObjectToArray (object) {
        return Object.keys(object).map(
          key => {
            return {
              name: key,
              value: object[key]
            }});
      }
    };

    MyBehaviors.VoteUpAppBehavior = [
      Polymer.AppNetworkStatusBehavior,
      VoteUpAppBehaviorImpl
    ];
</script>
